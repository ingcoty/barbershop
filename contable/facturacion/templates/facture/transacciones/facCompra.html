{% load adminlte_helpers i18n %}
{% load humanize %}
{% load static %}
<style type="text/css">
body {
  font-size: 15px;
}
.facturaAnulada:after {
  content: "ANULADO";
  font-size: 6em;
  color: rgba(52, 166, 214, 0.4);
  z-index: 9999;

  display: flex;
  align-items: center;
  justify-content: center;
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;

  -webkit-pointer-events: none;
  -moz-pointer-events: none;
  -ms-pointer-events: none;
  -o-pointer-events: none;
  pointer-events: none;

  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  -o-user-select: none;
  user-select: none;
}
</style>
<div class="modal fade" id="modalFactura" style="display: none;" aria-hidden="true">
    <div id="modalsize" class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <div class="invoice p-3 mb-3" id="invoice">
                    <!-- title row -->
                    <div class="row">
                        <div class="col-12">
                            <h4>
                                <img src="{% static 'img/logo_fac.jpeg' %}" alt="AdminLTE Logo"
                                     class="brand-image img-circle elevation-3" style="opacity: .8">
                                {{ empresa.nombre }}
                                <small class="float-right">Fecha: {{ factura.fecha }}</small>
                            </h4>
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- info row -->
                    <div class="row invoice-info">
                        <div class="col-sm-4 invoice-col">
                            <address>
                                <strong>{{empresa.nombre}}</strong><br>
                                {{empresa.nit}}</br>
                                {{empresa.dir}} - {{empresa.ciudad}} <br>
                                Teléfono: {{empresa.cell}}<br>
                                Email: {{empresa.email}}
                            </address>

                        </div>
                        <!-- /.col -->
                        <div class="col-sm-4 invoice-col">
                            <address>
                                <strong>{{ factura.tercero.nombre }}</strong><br>
                                {{factura.tercero.tipodocumento}} : {{factura.tercero.codigo}}<br>
                                {{factura.tercero.direccion}} - {{factura.tercero.ciudad}}<br>
                                Teléfono: {{factura.tercero.celular}}<br>
                                Email: {{factura.tercero.email}}
                            </address>
                        </div>
                        <!-- /.col -->
                        <div class="col-sm-4 invoice-col">
                            <b> {% if factura.tipo.id == 1 %}
                                Factura de Compra #{{ factura.consecutivo }}
                                {% elif factura.tipo.id == 2%}
                                Factura de Venta #{{ factura.consecutivo }}
                                {% elif factura.tipo.id == 3%}
                                Salida de Inventario #{{ factura.consecutivo }}
                                {% endif %}
                            </b><br>

                            Resolución: {{empresa.resolucion}}<br>
                            Relacion: {{ factura.relacion }}<br>
                            Forma de Pago: {{factura.fpago.fpago}}<br>
                                Estado: <b>{% if factura.estado == '1'%} ANULADO {% else %} ACTIVA {% endif %}<br>
                            </b>

                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->

                    <!-- Table row -->
                    <div class="row">
                        <div class="col-12 table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Cod</th>
                                    <th>Descripción</th>
                                    <th>Cant</th>
                                    <th>Precio</th>
                                    <th>Descuento</th>
                                    <th>Iva</th>
                                    <th>Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for producto in productos%}
                                <tr>
                                    <td>{{producto.codproduct.codigo}}</td>
                                    <td>{{producto.codproduct.descripcion}}</td>
                                    <td>{{producto.cantidad}}</td>

                                    {% if factura.estado == '1' %}
                                    <script>
                                         var element = document.getElementById("modalFactura");
                                         element.classList.add("facturaAnulada")
                                    </script>
                                    {% endif %}

                                    <td>{{producto.valor | intcomma }}</td>
                                    <td>{{producto.descuento | intcomma }}</td>
                                    <td>{{producto.impuesto | intcomma }}</td>
                                    <td>{{producto.total | intcomma }}</td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->

                    <div class="row">
                        <!-- accepted payments column -->
                        <div class="col-6">
                            <p class="lead"></p>

                        </div>
                        <!-- /.col -->
                        <div class="col-6">
                            <p class="lead">Totales</p>

                            <div class="table-responsive">
                                <table class="table">
                                    <tbody>
                                    <tr>
                                        <th style="width:50%">Subtotal:</th>
                                        <td id="global">${{ factura.total | intcomma}}</td>
                                    </tr>
                                    <tr>
                                        <th>Descuento</th>
                                        <td>${{ factura.descuento | intcomma}}</td>
                                    </tr>
                                    <tr>
                                        <th>Impuesto</th>
                                        <td>${{ factura.impuesto | intcomma}}</td>
                                    </tr>
                                    <tr>
                                        <th>Total:</th>
                                        <td>${{ factura.neto | intcomma}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->

                    <!-- this row will not appear when printing -->
                    <div class="row no-print">
                        <div class="col-12">
                            <a onclick="imprimir()" class="btn btn-default"><i
                                    class="fas fa-print"></i> Print</a>                           
                        </div>
                    </div>
                    <p>
                        <small class="float-right">Responsable: {{ factura.user }}</small>
                    </p>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<script>
   function imprimir(){
        var contentToPrint = document.getElementById('invoice')
        var win = window.open('', 'Print-Window')
        win.document.open()
        win.document.write('<!DOCTYPE html> <html><head><link rel="stylesheet" href="/static/admin-lte/dist/css/adminlte.min.css"></head><body style="font-size:15px;" onload="window.print()"><div> '+contentToPrint.innerHTML+'</div></body></html>')
        win.document.close()      
   }
</script>
